!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tinycrop=e():t.tinycrop=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){}function r(t){return"string"==typeof t&&(t.length>=1&&("%"===t[t.length-1]||void 0))}function h(t){return r(t)?t.slice(0,-1):0}function a(t){return"auto"===t}function u(t){return"number"==typeof t&&Math.round(t)===t}var c=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(8),d=n(l),f=i(3),g=n(f),v=i(5),y=n(v),b=i(7),p=n(b),w=i(4),m=n(w),x=i(1),_=n(x),R=400,k=300,C=function(){function t(e){o(this,t),this.parent="string"==typeof e.parent?document.querySelector(e.parent):e.parent,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.boundsOpts=e.bounds||{width:"100%",height:"auto"},e.selection=e.selection||{},e.selection.borderSize=e.selection.borderSize||1,this.rotation=e.rotation||0,this.debounceResize=void 0===e.debounceResize||e.debounceResize,this.listeners=_["default"].create(),this.parent.appendChild(this.canvas),this.backgroundLayer=g["default"].create({parent:this,context:this.context,colors:e.backgroundColors||["#fff","#f0f0f0"]}),this.imageLayer=y["default"].create({parent:this,context:this.context,image:this.image}),this.selectionLayer=p["default"].create({parent:this,context:this.context,target:this.imageLayer,aspectRatio:e.selection.aspectRatio,minWidth:e.selection.minWidth,minHeight:e.selection.minHeight,x:e.selection.x,y:e.selection.y,width:e.selection.width,height:e.selection.height,handle:{borderSize:e.selection.borderSize,color:e.selection.color,borderColor:e.selection.borderColor,activeColor:e.selection.activeColor,activeBorderColor:e.selection.activeBorderColor}});var i=this.listeners,n=this.paint.bind(this);this.selectionLayer.on("start",function(t){n(),i.notify("start",t)}).on("move",function(t){i.notify("move",t)}).on("resize",function(t){i.notify("resize",t)}).on("change",function(t){n(),i.notify("change",t)}).on("end",function(t){n(),i.notify("end",t)}),window.addEventListener("resize",this.debounceResize?(0,d["default"])(this.revalidateAndPaint.bind(this),100):this.revalidateAndPaint.bind(this)),this.setImage(e.image,e.onInit),this.revalidateAndPaint()}return c(t,[{key:"on",value:function(t,e){return this.listeners.on(t,e),this}},{key:"off",value:function(t,e){return this.listeners.off(t,e),this}},{key:"revalidateAndPaint",value:function(){this.revalidate(),this.paint()}},{key:"revalidate",value:function(){var t=this.parent,e=this.image,i=this.boundsOpts.width,n=this.boundsOpts.height,o=0,s=0;o=u(i)?i:t&&r(i)?Math.round(t.clientWidth*h(i)/100):R,s=u(n)?n:r(n)?Math.round(o*h(n)/100):e&&e.hasLoaded&&a(n)?Math.floor(o/e.getAspectRatio()):k,this.resizeCanvas(o,s),this.backgroundLayer.revalidate(),this.imageLayer.revalidate(),this.selectionLayer.revalidate()}},{key:"paint",value:function(){var t=this.context;t.save(),t.scale(this.ratio,this.ratio),this.backgroundLayer.paint(),this.image&&this.image.hasLoaded&&(this.imageLayer.paint(),this.selectionLayer.paint()),t.restore()}},{key:"resizeCanvas",value:function(t,e){var i=this.canvas;this.ratio=window.devicePixelRatio||1,this.width=t,this.height=e,i.width=this.width*this.ratio,i.height=this.height*this.ratio}},{key:"rotate",value:function(t){this.rotation=t,this.paint()}},{key:"setImage",value:function(t,e){var i=this,n=m["default"].create(t).on("load",function(){i.selectionLayer.onImageLoad(),i.revalidateAndPaint(),e&&e()}).on("error",function(t){console.error(t)});this.imageLayer.setImage(n),this.image=n,this.revalidateAndPaint()}},{key:"getImage",value:function(){return this.image}},{key:"setAspectRatio",value:function(t){this.selectionLayer.setAspectRatio(t),this.revalidateAndPaint()}},{key:"setBounds",value:function(t){this.boundsOpts=t,this.revalidateAndPaint()}},{key:"setBackgroundColors",value:function(t){this.backgroundLayer.setColors(t),this.revalidateAndPaint()}}]),t}();C.create=function(t){return new C(t)},C.prototype.dispose=s,t.exports=C},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var n=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){i(this,t),this.events={}}return n(t,[{key:"on",value:function(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].indexOf(e)===-1&&this.events[t].push(e),this}},{key:"off",value:function(t,e){if(this.events[t]){var i=this.events[t].indexOf(e);i!==-1&&this.events[t].splice(i,1)}return this}},{key:"notify",value:function(t,e){var i=this;this.events[t]&&this.events[t].forEach(function(t){t.call(i,e)})}},{key:"clearAll",value:function(){this.events={}}}]),t}();o.create=function(t){return new o(t)},e["default"]=o},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var n=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e,n,o,s){i(this,t),this._x=e,this._y=n,this._width=o,this._height=s}return n(t,[{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this}},{key:"clone",value:function(){return t.create(this._x,this._y,this._width,this._height)}},{key:"round",value:function(){var t=this._x,e=this._y;return this._x=Math.round(t),this._y=Math.round(e),t-=this._x,e-=this._y,this._width=Math.round(this._width+t),this._height=Math.round(this._height+e),this}},{key:"isInside",value:function(t){return t.x>=this.left&&t.y>=this.top&&this.right>t.x&&this.bottom>t.y}}]),t}();Object.defineProperties(o.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t}},y:{get:function(){return this._y},set:function(t){this._y=t}},centerX:{get:function(){return this._x+.5*this._width},set:function(t){this._x=t-.5*this._width}},centerY:{get:function(){return this._y+.5*this._height},set:function(t){this._y=t-.5*this._height}},width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}},left:{get:function(){return this._x},set:function(t){this._width=this._x+this._width-t,this._x=t}},top:{get:function(){return this._y},set:function(t){this._height=this._y+this._height-t,this._y=t}},right:{get:function(){return this._x+this._width},set:function(t){this._width=t-this._x}},bottom:{get:function(){return this._y+this._height},set:function(t){this._height=t-this._y}},aspectRatio:{get:function(){return this._width/this._height}}}),o.create=function(t,e,i,n){return new o(t,e,i,n)},e["default"]=o},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var n=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this.colors=e.colors,this.parent=e.parent,this.context=e.context,this.isDirty=!0}return n(t,[{key:"revalidate",value:function(){this.isDirty=!0}},{key:"setColors",value:function(t){this.colors=t}},{key:"paint",value:function(){if(this.isDirty){var t=this.parent,e=this.context;if(this.colors&&this.colors.length?(e.fillStyle=this.colors[0],e.fillRect(0,0,t.width,t.height)):e.clearRect(0,0,t.width,t.height),this.colors&&this.colors.length>1){var i=t.height,n=32,o=t.width/n,s=Math.ceil(i/o);e.fillStyle=this.colors[1];for(var r=0;n>r;r+=1)for(var h=0;s>h;h+=1)(r+h)%2===0&&e.fillRect(r*o,h*o,o,o)}this.isDirty=!1}}}]),t}();o.create=function(t){return new o(t)},e["default"]=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(9),h=n(r),a=i(1),u=n(a),c=function(){function t(e){var i=this;if(o(this,t),this.width=0,this.height=0,this.hasLoaded=!1,this.src=null,this.listeners=u["default"].create(),e){if("string"==typeof e){this.src=e;var n=document.createElement("img");n.src=this.src,e=n}else this.src=e.src;this.source=e,(0,h["default"])(e,function(t){t?i.notify("error",t):(i.hasLoaded=!0,i.width=e.naturalWidth,i.height=e.naturalHeight,i.notify("load",i))})}}return s(t,[{key:"getAspectRatio",value:function(){return this.hasLoaded?this.width/this.height:1}},{key:"notify",value:function(t,e){var i=this.listeners;setTimeout(function(){i.notify(t,e)},0)}},{key:"on",value:function(t,e){return this.listeners.on(t,e),this}},{key:"off",value:function(t,e){return this.listeners.off(t,e),this}}]),t}();c.create=function(t){return new c(t)},e["default"]=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(2),h=n(r),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this.bounds=h["default"].create(0,0,0,0),this.image=e.image||null,this.parent=e.parent,this.context=e.context}return s(t,[{key:"setImage",value:function(t){this.image=t}},{key:"revalidate",value:function(){var t=this.parent,e=this.image,i=this.bounds;e&&(t.width/t.height>e.width/e.height?(i.width=Math.ceil(e.width/e.height*t.height),i.height=t.height,i.x=Math.floor(.5*(t.width-i.width)),i.y=0):(i.width=t.width,i.height=Math.ceil(e.height/e.width*t.width),i.x=0,i.y=Math.floor(.5*(t.height-i.height))))}},{key:"paint",value:function(){var t=this.context,e=this.image,i=this.bounds;if(e&&e.hasLoaded){var n=Math.PI/180,o=this.parent.rotation*n;t.clearRect(0,0,e.width,e.height),t.save(),t.translate(.5*e.width,.5*e.height),t.rotate(o),t.translate(.5*-e.width,.5*-e.height),t.drawImage(e.source,0,0,e.width,e.height,i.x,i.y,i.width,i.height),t.restore()}}}]),t}();a.create=function(t){return new a(t)},e["default"]=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(2),h=n(r),a=function(){function t(e){o(this,t),this.target=e.target||null,this.bounds=h["default"].create(0,0,0,0),this.boundsPx=h["default"].create(0,0,0,0),this.region=h["default"].create(0,0,0,0),this.initialOpts={x:e.x,y:e.y,width:e.width,height:e.height},this.aspectRatio=e.aspectRatio,this.minWidth=void 0!==e.minWidth?e.minWidth:100,this.minHeight=void 0!==e.minHeight?e.minHeight:100,this.boundsMinWidth=0,this.boundsMinHeight=0,this._delta={x:0,h:0}}return s(t,[{key:"getBoundsLengthForRegion",value:function(t){return t/this.region.width*this.width}},{key:"moveBy",value:function(t,e){var i=this.bounds,n=this.target;return i.x=Math.min(Math.max(i.x+t,n.bounds.x),n.bounds.x+n.bounds.width-i.width),i.y=Math.min(Math.max(i.y+e,n.bounds.y),n.bounds.y+n.bounds.height-i.height),this.updateRegionFromBounds()}},{key:"resizeBy",value:function(t,e,i){function n(t,e){return o.width=r.width+t,o.height=r.height+e,o.width=Math.max(h,o.width),o.height=Math.max(a,o.height),s&&(o.width/o.height>s?o.width=o.height*s:o.height=o.width/s),o.width-=r.width,o.height-=r.height,o}var o=this._delta,s=this.aspectRatio,r=this.bounds,h=this.boundsMinWidth,a=this.boundsMinHeight,u=this.target;switch("n"===i[0]?e=Math.min(e,this.top-u.bounds.top):"s"===i[0]&&(e=Math.min(e,u.bounds.bottom-this.bottom)),i.indexOf("w")>-1?t=Math.min(t,this.left-u.bounds.left):i.indexOf("e")>-1&&(t=Math.min(t,u.bounds.right-this.right)),o=n(t,e),i){case"n":this.top-=o.height;break;case"s":this.bottom+=o.height;break;case"e":this.right+=o.width;break;case"w":this.left-=o.width;break;case"nw":this.left-=o.width,this.top-=o.height;break;case"ne":this.right+=o.width,this.top-=o.height;break;case"sw":this.left-=o.width,this.bottom+=o.height;break;case"se":this.right+=o.width,this.bottom+=o.height}return this.updateRegionFromBounds()}},{key:"autoSizeRegion",value:function(){var t=this.target,e=this.region,i=this.aspectRatio,n=this.initialOpts,o=e.x,s=e.y,r=e.width,h=e.height;return e.x=void 0!==n.x?n.x:0,e.y=void 0!==n.y?n.y:0,e.width=void 0!==n.width?n.width:t.image.width,e.height=void 0!==n.height?n.height:t.image.height,i&&(e.width/e.height>i?e.width=e.height*i:e.height=e.width/i),void 0===n.x&&(e.centerX=.5*t.image.width),void 0===n.y&&(e.centerY=.5*t.image.height),e.round(),this.updateBoundsFromRegion(),e.x!==o||e.y!==s||e.width!==r||e.height!==h}},{key:"updateRegionFromBounds",value:function(){var t=this.target,e=this.region,i=this.bounds,n=e.x,o=e.y,s=e.width,r=e.height;return e.x=t.image.width*(i.x-t.bounds.x)/t.bounds.width,e.y=t.image.height*(i.y-t.bounds.y)/t.bounds.height,e.width=t.image.width*(i.width/t.bounds.width),e.height=t.image.height*(i.height/t.bounds.height),e.round(),e.x!==n||e.y!==o||e.width!==s||e.height!==r}},{key:"updateBoundsFromRegion",value:function(){var t=this.target,e=this.region,i=this.bounds;t.image&&(i.x=t.bounds.x+t.bounds.width*(e.x/t.image.width),i.y=t.bounds.y+t.bounds.height*(e.y/t.image.height),i.width=t.bounds.width*(e.width/t.image.width),i.height=t.bounds.height*(e.height/t.image.height)),this.boundsMinWidth=this.getBoundsLengthForRegion(this.minWidth),this.boundsMinHeight=this.getBoundsLengthForRegion(this.minHeight)}},{key:"isInside",value:function(t){return this.bounds.isInside(t)}}]),t}();Object.defineProperties(a.prototype,{x:{get:function(){return this.bounds.x},set:function(t){this.bounds.x=t}},y:{get:function(){return this.bounds.y},set:function(t){this.bounds.y=t}},width:{get:function(){return this.bounds.width},set:function(t){this.bounds.width=t}},height:{get:function(){return this.bounds.height},set:function(t){this.bounds.height=t}},left:{get:function(){return this.bounds.x},set:function(t){this.bounds.left=t}},top:{get:function(){return this.bounds.y},set:function(t){this.bounds.top=t}},right:{get:function(){return this.bounds.right},set:function(t){this.bounds.right=t}},bottom:{get:function(){return this.bounds.bottom},set:function(t){this.bounds.bottom=t}}}),a.create=function(t){return new a(t)},e["default"]=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(11),a=n(h),u=i(1),c=n(u),l=i(6),d=n(l),f=i(2),g=n(f),v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),this.selection=d["default"].create(e),this.parent=e.parent,this.context=e.context,this.context.setLineDash=this.context.setLineDash||function(){},this.target=e.target;var i=e.handle||{};i.length=i.handleLength||32,i.depth=i.depth||3,i.size=i.size||2*i.length,i.color=i.color||"rgba(255, 255, 255, 1.0)",i.borderColor=i.borderColor||i.color,i.activeColor=i.activeColor||"rgba(255, 0, 160, 1.0)",i.activeBorderColor=i.activeBorderColor||i.activeColor,this.handleOpts=i,this.listeners=c["default"].create(),this.touch=(0,a["default"])(this.parent.canvas),this.activeRegion=null,this.downBounds=g["default"].create(0,0,0,0),this.touch.on("down",this.onInputDown.bind(this)).on("move",this.onInputMove.bind(this)).on("up",this.onInputUpOrCancel.bind(this)).on("cancel",this.onInputUpOrCancel.bind(this))}return r(t,[{key:"onInputDown",value:function(t){var e=this.findHitRegion(t);e&&(t.source.preventDefault(),this.activeRegion=e,this.setCursor(e),this.downBounds.copy(this.selection.bounds),this.listeners.notify("start",this.selection.region))}},{key:"onInputMove",value:function(t){var e=this.activeRegion;if(e){t.source.preventDefault();var i=this.selection,n=!1;if(i.bounds.copy(this.downBounds),"move"===e)n=i.moveBy(t.tx,t.ty),n&&this.listeners.notify("move",this.selection.region);else{var o=e.substring(0,2).replace("-",""),s=o.indexOf("w")>-1?-t.tx:t.tx,r="n"===o[0]?-t.ty:t.ty;n=i.resizeBy(s,r,o),n&&this.listeners.notify("resize",this.selection.region)}n&&this.listeners.notify("change",this.selection.region)}else{var h=this.findHitRegion(t);h?(t.source.preventDefault(),this.setCursor(h)):this.resetCursor()}}},{key:"onInputUpOrCancel",value:function(t){t.source.preventDefault(),this.activeRegion&&(this.activeRegion=null,this.resetCursor(),this.listeners.notify("end",this.selection.region))}},{key:"findHitRegion",value:function(t){var e=null,i=Number.MAX_VALUE,n=this.isWithinNorthHandle(t);return n!==!1&&i>n&&(i=n,e="n-resize"),n=this.isWithinSouthHandle(t),n!==!1&&i>n&&(i=n,e="s-resize"),n=this.isWithinEastHandle(t),n!==!1&&i>n&&(i=n,e="e-resize"),n=this.isWithinWestHandle(t),n!==!1&&i>n&&(i=n,e="w-resize"),n=this.isWithinNorthWestHandle(t),n!==!1&&i>n&&(i=n,e="nw-resize"),n=this.isWithinNorthEastHandle(t),n!==!1&&i>n&&(i=n,e="ne-resize"),n=this.isWithinSouthWestHandle(t),n!==!1&&i>n&&(i=n,e="sw-resize"),n=this.isWithinSouthEastHandle(t),n!==!1&&i>n&&(i=n,e="se-resize"),e?e:this.isWithinBounds(t)?"move":null}},{key:"on",value:function(t,e){return this.listeners.on(t,e),this}},{key:"off",value:function(t,e){return this.listeners.off(t,e),this}},{key:"setCursor",value:function(t){this.parent.canvas.style.cursor!==t&&(this.parent.canvas.style.cursor=t)}},{key:"resetCursor",value:function(){this.setCursor("auto")}},{key:"isWithinRadius",value:function(t,e,i,n,o){var s=o*o,r=t-i,h=e-n,a=r*r+h*h;return s>a&&a}},{key:"isWithinNorthHandle",value:function(t){var e=this.selection.width/2,i=e+this.selection.left;return this.isWithinRadius(t.x,t.y,i,this.selection.top,this.getCrossHandleRadius())}},{key:"isWithinSouthHandle",value:function(t){var e=this.selection.width/2,i=e+this.selection.left;return this.isWithinRadius(t.x,t.y,i,this.selection.bottom,this.getCrossHandleRadius())}},{key:"isWithinEastHandle",value:function(t){var e=this.selection.height/2,i=e+this.selection.top;return this.isWithinRadius(t.x,t.y,this.selection.right,i,this.getCrossHandleRadius())}},{key:"isWithinWestHandle",value:function(t){var e=this.selection.height/2,i=e+this.selection.top;return this.isWithinRadius(t.x,t.y,this.selection.left,i,this.getCrossHandleRadius())}},{key:"isWithinNorthWestHandle",value:function(t){return this.isWithinRadius(t.x,t.y,this.selection.left,this.selection.top,this.getCornerHandleRadius())}},{key:"isWithinNorthEastHandle",value:function(t){return this.isWithinRadius(t.x,t.y,this.selection.right,this.selection.top,this.getCornerHandleRadius())}},{key:"isWithinSouthWestHandle",value:function(t){return this.isWithinRadius(t.x,t.y,this.selection.left,this.selection.bottom,this.getCornerHandleRadius())}},{key:"isWithinSouthEastHandle",value:function(t){return this.isWithinRadius(t.x,t.y,this.selection.right,this.selection.bottom,this.getCornerHandleRadius())}},{key:"isWithinBounds",value:function(t){return this.selection.isInside(t)}},{key:"getCrossHandleRadius",value:function(){return this.handleOpts.size/4}},{key:"getCornerHandleRadius",value:function(){return this.handleOpts.size/2}},{key:"onImageLoad",value:function(){this.autoSizeRegionAndNotify()}},{key:"setAspectRatio",value:function(t){this.selection.aspectRatio=t,this.autoSizeRegionAndNotify()}},{key:"autoSizeRegionAndNotify",value:function(){var t=this.selection.autoSizeRegion();t&&this.listeners.notify("change",this.selection.region)}},{key:"revalidate",value:function(){this.selection.updateBoundsFromRegion()}},{key:"paint",value:function(){this.selection.boundsPx.copy(this.selection.bounds).round(),this.paintOutside(),this.paintInside()}},{key:"paintOutside",value:function(){var t=this.selection.boundsPx,e=this.context,i=this.target,n=i.bounds.x,o=i.bounds.y,s=i.bounds.width,r=i.bounds.right,h=i.bounds.bottom,a=t.x,u=t.y,c=t.height,l=t.right,d=t.bottom;e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(n,o,s,u-o),e.fillRect(n,u,a-n,c),e.fillRect(l,u,r-l,c),e.fillRect(n,d,s,h-d)}},{key:"paintInside",value:function(){var t,e=this.context,i=this.selection.boundsPx,n=this.activeRegion,s=this.handleOpts,r=Math.min(s.length,.5*i.width),h=Math.min(s.length,.5*i.height),a=s.depth,u=s.color,c=s.borderColor,l=s.activeColor,d=s.activeBorderColor,f=0;e.fillStyle="rgba(255, 255, 255, 0.3)",e.fillRect(i.x+f,i.y,i.width-2*f,a),e.fillRect(i.x+f,i.bottom-a,i.width-2*f,a),e.fillRect(i.x,i.y+f,a,i.height-2*f),e.fillRect(i.right-a,i.y+f,a,i.height-2*f);var g="move"===n,v=i.width/2,y=i.height/2,b=r/2,p=v-b+i.x,w=y-b+i.y,m=(t={borderSize:s.borderSize,activeRegion:n,isMoveRegion:g,borderColor:c,activeBorderColor:d,color:u},o(t,"borderColor",c),o(t,"activeColor",l),o(t,"activeBorderColor",d),o(t,"width",r),o(t,"height",h),o(t,"depth",s.depth),t);this.renderCrossHandle("n-resize",p,i.y,m),this.renderCrossHandle("s-resize",p,i.bottom-a,m),this.renderCrossHandle("e-resize",i.right-a,w,m),this.renderCrossHandle("w-resize",i.x,w,m),this.renderCornerHandle("nw-resize",i,m),this.renderCornerHandle("ne-resize",i,m),this.renderCornerHandle("sw-resize",i,m),this.renderCornerHandle("se-resize",i,m),e.strokeStyle="rgba(255, 255, 255, 0.6)",e.setLineDash([2,3]),e.lineWidth=1,e.beginPath();var x=i.width/3,_=i.height/3;e.moveTo(i.x+x,i.y),e.lineTo(i.x+x,i.y+i.height),e.moveTo(i.x+2*x,i.y),e.lineTo(i.x+2*x,i.y+i.height),e.moveTo(i.x,i.y+_),e.lineTo(i.x+i.width,i.y+_),e.moveTo(i.x,i.y+2*_),e.lineTo(i.x+i.width,i.y+2*_),e.stroke(),e.closePath()}},{key:"renderCrossHandle",value:function(t,e,i,n){var o=this.context,s=null,r=null;"n"==t[0]||"s"==t[0]?(s=n.width,r=n.depth):"e"!=t[0]&&"w"!=t[0]||(s=n.depth,r=n.height),o.fillStyle=n.isMoveRegion||n.activeRegion===t?n.activeBorderColor:n.borderColor,o.fillRect(e,i,s,r),o.fillStyle=n.isMoveRegion||n.activeRegion===t?n.activeColor:n.color,o.fillRect(e+n.borderSize,i+n.borderSize,s-2*n.borderSize,r-2*n.borderSize)}},{key:"renderCornerHandle",value:function(t,e,i){var n=this.context,o=i.width,s=i.depth,r=i.depth,h=i.height-i.depth,a=null,u=null,c=null,l=null,d=null;"n"==t[0]?(u=e.y,l=e.y+i.depth,d=l-i.borderSize):"s"==t[0]&&(u=e.bottom-i.depth,l=e.bottom-i.height,d=l+i.borderSize),"e"==t[1]?(a=e.right-i.width,c=e.right-i.depth):"w"==t[1]&&(a=e.x,c=e.x),n.fillStyle=i.isMoveRegion||i.activeRegion===t?i.activeBorderColor:i.borderColor,n.fillRect(a,u,o,s),n.fillRect(c,l,r,h),n.fillStyle=i.isMoveRegion||i.activeRegion===t?i.activeColor:i.color,n.fillRect(a+i.borderSize,u+i.borderSize,o-2*i.borderSize,s-2*i.borderSize),n.fillRect(c+i.borderSize,d,r-2*i.borderSize,h)}}]),t}();v.create=function(t){return new v(t)},e["default"]=v},function(t,e){"use strict";function i(t,e,i){var n=void 0;return function(){var o=this,s=arguments;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(o,s)},e),i&&!n&&t.apply(o,s)}}e.__esModule=!0,e["default"]=i},function(t,e){"use strict";function i(t,e){if(!t.nodeName||"img"!==t.nodeName.toLowerCase())return e(Error("First argument must an image element"));if(t.src&&t.complete&&void 0!==t.naturalWidth)return e(null,!0);if(t.addEventListener("load",function(){e(null,!1)}),t.addEventListener("error",function(i){e(Error("Failed to load image '"+(t.src||"")+"'"))}),t.complete){var i=t.src;t.src=n,t.src=i}}e.__esModule=!0;var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e["default"]=i},function(t,e){function i(){}i.prototype={on:function(t,e,i){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){function n(){o.off(t,n),e.apply(i,arguments)}var o=this;return n._=e,this.on(t,n,i)},emit:function(t){var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),n=0,o=i.length;for(n;o>n;n++)i[n].fn.apply(i[n].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),n=i[t],o=[];if(n&&e)for(var s=0,r=n.length;r>s;s++)n[s].fn!==e&&n[s].fn._!==e&&o.push(n[s]);return o.length?i[t]=o:delete i[t],this}},t.exports=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.CANCEL=e.UP=e.DRAG=e.MOVE=e.DOWN=void 0;var o=i(10),s=n(o),r=function(t){return function(e,i){t.addEventListener(e,i)}},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,e=new s["default"],i={},n=r(t),o=null,h=null,f=function(t,n){return e.on(t,n),i},g=function(t,n){return e.once(t,n),i},v=function(t,n){return e.off(t,n),i},y=function(){return!!o},b=function(t,e,i,n){var s=h||o;return{source:t,x:e,y:i,dx:s?e-s.x:0,dy:s?i-s.y:0,tx:o?e-o.x:0,ty:o?i-o.y:0,type:n}},p=function(t){var e=t.target||t.srcElement,i=e.getBoundingClientRect(),n=t.clientX-i.left,o=t.clientY-i.top;return b(t,n,o,"Mouse")},w=function(t){var e=t.target.getBoundingClientRect(),i=t.touches.length>0?t.touches[0]:t.changedTouches[0],n=i.clientX-e.left,o=i.clientY-e.top;return b(t,n,o,"Touch")},m=function(t){o=t,e.emit(a,t)},x=function(t){h=t,e.emit(u,t),y()&&e.emit(c,t)},_=function(t){e.emit(l,t),o=null,h=null},R=function(t){e.emit(d,t),o=null,h=null};return n("mousedown",function(t){return m(p(t))}),n("touchstart",function(t){return m(w(t))}),n("mousemove",function(t){return x(p(t))}),n("touchmove",function(t){return x(w(t))}),n("mouseup",function(t){return _(p(t))}),n("touchend",function(t){return _(w(t))}),n("mouseout",function(t){return R(p(t))}),n("touchcancel",function(t){return R(w(t))}),i.on=f,i.once=g,i.off=v,i};e["default"]=h;var a=e.DOWN="down",u=e.MOVE="move",c=e.DRAG="drag",l=e.UP="up",d=e.CANCEL="cancel"}])});